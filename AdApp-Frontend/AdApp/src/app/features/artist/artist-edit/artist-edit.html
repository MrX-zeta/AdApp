<div class="page">
	<section class="profile-card">
		<header class="profile-header">
			<div class="avatar-container" (click)="triggerFileInput()" [class.uploading]="isUploadingImage">
				<img class="avatar" [src]="profileImageUrl" alt="avatar" />
				<div class="avatar-overlay">
					<span *ngIf="!isUploadingImage">Cambiar foto</span>
					<span *ngIf="isUploadingImage">Subiendo...</span>
				</div>
			</div>
			<input 
				type="file" 
				id="profileImageInput" 
				accept="image/*" 
				style="display: none;" 
				(change)="onProfileImageSelected($event)" />
			<div class="stats">
				<div class="followers"><strong>{{ followers | number }}</strong> seguidores</div>
				<div class="actions">
					<button class="btn secondary" type="button" (click)="addSong()">
						<img src="/media/icons/musica.png" alt="icon" />
						Agregar canción
					</button>
					<button class="btn secondary" type="button" (click)="publishEvent()">
						<img src="/media/icons/calendario.png" alt="icon" />
						Publicar evento
					</button>
				</div>
			</div>
		</header>

		<form [formGroup]="form" (ngSubmit)="save()" class="form">
			<div class="row">
				<div class="col">
					<h3>Información personal</h3>
					<label class="field">
						<span>Nombre artístico</span>
						<input formControlName="name" placeholder="Nombre artístico" />
					</label>
					<label class="field">
						<span>Descripción</span>
						<textarea rows="4" formControlName="description" placeholder="Descripción"></textarea>
					</label>
				</div>

				<div class="col">
					<h3>Redes y contacto</h3>
					<label class="field with-icon">
						<img src="/media/icons/instagram.png" alt="Instagram" />
						<input formControlName="instagram" placeholder="Instagram" />
					</label>
					<label class="field with-icon">
						<img src="/media/icons/facebook.png" alt="Facebook" />
						<input formControlName="facebook" placeholder="Facebook" />
					</label>
				<div class="field with-icon">
					<img src="/media/icons/llamada.png" alt="Teléfono" />
					<div class="field-wrapper">
						<input formControlName="phone" placeholder="Teléfono" />
						<span class="error-message" *ngIf="form.get('phone')?.invalid && form.get('phone')?.touched">
							Formato de teléfono inválido
						</span>
					</div>
				</div>
					<label class="field with-icon">
						<img src="/media/icons/gmail.png" alt="Email" />
						<input formControlName="email" placeholder="Correo" />
					</label>
				</div>
			</div>

			<footer class="form-actions">
						<button class="btn success" type="submit">Guardar</button>
				<button class="btn ghost" type="button" (click)="cancel()">Cancelar</button>
				<button class="btn danger" type="button" (click)="deleteAccount()" style="margin-left: auto;">Eliminar cuenta</button>
				</footer>
		</form>
	</section>

	<aside class="feed">
		<h3>Eventos y canciones</h3>

		<article class="post" *ngFor="let event of events">
			<header>
				<span class="title">{{ event.title || 'Sin título' }}</span>
				<time>Publicado el {{ event.date | date: 'dd/MM/yyyy' }}</time>
			</header>
			<p>{{ event.description }}</p>
			<div class="post-actions">
				<button class="icon" type="button" title="Editar" (click)="editEvent(event.id)">
					<img src="/media/icons/boton-editar.png" alt="edit" />
				</button>
				<button class="icon" type="button" title="Eliminar" (click)="deleteEvent(event.id)">
					<img src="/media/icons/basura.png" alt="delete" />
				</button>
			</div>
		</article>

		<article class="post song" *ngFor="let song of songs">
			<header>
				<div class="song-info">
					<span class="title">{{ song.title || 'Sin título' }}</span>
					<time>Publicado el {{ song.dateUploaded | date: 'dd/MM/yyyy' }}</time>
				</div>
				<button 
					class="play-button" 
					type="button" 
					(click)="togglePlaySong(song)"
					title="{{ currentPlayingSong?.id === song.id && !audioPlayer?.paused ? 'Pausar' : 'Reproducir' }}">
					<span *ngIf="currentPlayingSong?.id !== song.id || audioPlayer?.paused">▶</span>
					<span *ngIf="currentPlayingSong?.id === song.id && !audioPlayer?.paused">⏸</span>
				</button>
			</header>
			<div class="post-actions">
				<button class="icon" type="button" title="Editar" (click)="editSong(song.id)">
					<img src="/media/icons/boton-editar.png" alt="edit" />
				</button>
				<button class="icon" type="button" title="Eliminar" (click)="deleteSong(song.id)">
					<img src="/media/icons/basura.png" alt="delete" />
				</button>
			</div>
		</article>

		<div class="empty-state" *ngIf="events.length === 0 && songs.length === 0">
			<p>No hay eventos ni canciones publicadas aún.</p>
		</div>
	</aside>

	<div class="modal-backdrop" *ngIf="showSongModal" (click)="closeSong()"></div>
	<div class="modal" *ngIf="showSongModal" role="dialog" aria-modal="true">
			<header class="modal-header">
				<h4>Agregar canción</h4>
				<button class="icon close" type="button" (click)="closeSong()">
					<img src="/media/icons/equis.png" alt="Cerrar" />
				</button>
			</header>
		<form class="modal-body" [formGroup]="songForm" (ngSubmit)="submitSong()">
			<label class="field">
				<span>Título</span>
				<input formControlName="title" placeholder="Título de la canción" />
			</label>
				<label class="field">
					<span>Archivo de audio</span>
					<input type="file" accept="audio/*" (change)="onSongFileSelected($event)" />
				</label>
			<footer class="modal-actions">
				<button class="btn success" type="submit">Subir</button>
				<button class="btn ghost" type="button" (click)="closeSong()">Cancelar</button>
			</footer>
		</form>
		</div>

	<div class="modal-backdrop" *ngIf="showEventModal" (click)="closeEvent()"></div>
	<div class="modal" *ngIf="showEventModal" role="dialog" aria-modal="true">
			<header class="modal-header">
				<h4>Publicar evento</h4>
				<button class="icon close" type="button" (click)="closeEvent()">
					<img src="/media/icons/equis.png" alt="Cerrar" />
				</button>
			</header>
				<form class="modal-body" [formGroup]="eventForm" (ngSubmit)="submitEvent()">
					<label class="field">
						<span>Título</span>
						<input formControlName="title" placeholder="Nombre del evento" />
					</label>
					<label class="field">
						<span>Descripción</span>
						<textarea rows="6" formControlName="description" placeholder="Escribe los detalles del evento (incluye fecha, hora, lugar, etc.)"></textarea>
					</label>
			<footer class="modal-actions">
				<button class="btn success" type="submit">Publicar</button>
				<button class="btn ghost" type="button" (click)="closeEvent()">Cancelar</button>
			</footer>
		</form>
		</div>

	<div class="modal-backdrop" *ngIf="showSuccessModal" (click)="closeSuccessModal()"></div>
	<div class="modal success-modal" *ngIf="showSuccessModal" role="dialog" aria-modal="true">
		<header class="modal-header">
			<h4>¡Cambios guardados!</h4>
		</header>
		<div class="modal-body success-body">
			<div class="success-icon">✓</div>
			<p>Tu información ha sido actualizada exitosamente.</p>
		</div>
	</div>

	<div class="modal-backdrop" *ngIf="showAlertModal" (click)="alertType !== 'confirm' ? closeAlert() : null"></div>
	<div class="modal alert-modal" [ngClass]="alertType" *ngIf="showAlertModal" role="dialog" aria-modal="true">
		<header class="modal-header">
			<h4 *ngIf="alertTitle">{{ alertTitle }}</h4>
			<h4 *ngIf="!alertTitle && alertType === 'success'">¡Éxito!</h4>
			<h4 *ngIf="!alertTitle && alertType === 'error'">Error</h4>
			<h4 *ngIf="!alertTitle && alertType === 'warning'">Atención</h4>
			<h4 *ngIf="!alertTitle && alertType === 'confirm'">Confirmar</h4>

		</header>
		<div class="modal-body alert-body">
			<div class="alert-icon">
				<span *ngIf="alertType === 'success'">✓</span>
				<span *ngIf="alertType === 'error'">✕</span>
				<span *ngIf="alertType === 'warning' || alertType === 'confirm'">!</span>
			</div>
			<p>{{ alertMessage }}</p>
		</div>
		<footer class="modal-actions alert-actions">
			<ng-container *ngIf="alertType === 'confirm'; else singleButton">
				<button class="btn danger" type="button" (click)="confirmAction()">Eliminar</button>
				<button class="btn ghost" type="button" (click)="closeAlert()">Cancelar</button>
			</ng-container>
			<ng-template #singleButton>
				<button class="btn" [ngClass]="{'success': alertType === 'success', 'danger': alertType === 'error', 'warning': alertType === 'warning'}" type="button" (click)="closeAlert()">Aceptar</button>
			</ng-template>
		</footer>
	</div>
</div>
